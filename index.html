<!DOCTYPE html>
<html lang="ja">
<head>
  <meta name="google-site-verification" content="61fo7jboEh_yjqDy9wookQE0lFghsk4CQnk5VNTj1m0" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="google-site-verification" content="61fo7jboEh_yjqDy9wookQE0lFghsk4CQnk5VNTj1m0" />
  <title>被験者募集掲示板</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- ✅ ヘッダー（共通） -->
  <header class="site-header">
    <nav class="navbar">
      <h1 class="logo"><a href="index.html">被験者募集掲示板</a></h1>
      <ul class="nav-links">
        <li><a href="index.html">ホーム</a></li>
        <li><a href="policy.html">ポリシー</a></li>
        <li><a href="recruit.html">掲載</a></li>
        <li><a href="contact.html">お問い合わせ</a></li>
      </ul>
      
      <script>
  // 現在のページファイル名を取得（例: "policy.html"）
  const currentPage = window.location.pathname.split("/").pop();

  // すべてのナビゲーションリンクを取得
  const navLinks = document.querySelectorAll(".nav-links a");

  navLinks.forEach(link => {
    // 各リンクのhrefを比較
    if (link.getAttribute("href") === currentPage) {
      link.classList.add("active"); // 一致したリンクにactiveを付与
    }
  });
</script>

    </nav>
  </header>

  <!-- ✅ メイン -->
  <main class="container">
    
      <!-- ✅ サイト説明文（投稿の上に追加） -->
  <section class="intro-section">
    <h2>このサイトについて</h2>
    <p>
      このサイト「被験者募集掲示板」は、研究や実験などへの参加希望者を募集する目的で運営されています。<br>
      研究参加の際はポリシーをご確認ください。
    </p>
    <p class="official-links">
  <a href="https://x.com/hikennsya_keiji" target="_blank">X(旧Twitter)</a> ｜ 
  <a href="https://www.threads.net/@hikennsya_keijiban" target="_blank">Threads</a>
</p>
  </section>
    
    <section id="posts" class="post-list">
      <div id="loading" class="loading">投稿を読み込んでいます...</div>
      <div id="error" class="error" style="display:none;">投稿データを読み込めませんでした。</div>
    </section>
  </main>

 
  <footer class="footer">
    © 被験者募集掲示板
  </footer>
  
  <!-- ✅ Googleスプレッドシート連携 -->
  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRwty1oe-6s7l6GPnMyo-nhQk2vDfnWKsdlzmgdGo1ey7g1QNLusXc_iIbAJYdE8RhLwRnLobvrBvDV/pub?gid=821609257&single=true&output=csv';

    const postsContainer = document.getElementById('posts');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');

    // ✅ カンマ・改行対応CSVパーサー
    function parseCSV(text) {
      const rows = [];
      let current = '';
      let insideQuote = false;
      let row = [];

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        if (char === '"') {
          if (text[i + 1] === '"') {
            current += '"';
            i++;
          } else {
            insideQuote = !insideQuote;
          }
        } else if (char === ',' && !insideQuote) {
          row.push(current);
          current = '';
        } else if ((char === '\n' || char === '\r') && !insideQuote) {
          if (current || row.length) {
            row.push(current);
            rows.push(row);
            row = [];
            current = '';
          }
        } else {
          current += char;
        }
      }
      if (current || row.length) row.push(current);
      if (row.length) rows.push(row);
      return rows;
    }
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ハート＆通報ボタン</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="post" data-id="post1">
    <p>この投稿へのリアクション</p>
    <button class="heart-btn" onclick="sendReaction('heart', 'post1')">❤️<span class="heart-count">0</span></button>
    <button class="report-btn" onclick="sendReaction('report', 'post1')">🚨<span class="report-count">0</span></button>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwaMGt-e6TBlvvYMY9YWvFT7_aDs-sQ8E4Zy55wxsd87lpNEPRWKaPzaWHgsJkyp6hHUA/exec";

    // ページ読み込み時に現在の合計を取得
    document.addEventListener("DOMContentLoaded", () => {
      fetch(scriptURL + "?action=getCounts&id=post1")
        .then(res => res.json())
        .then(data => {
          document.querySelector(".heart-count").textContent = data.heart || 0;
          document.querySelector(".report-count").textContent = data.report || 0;
        });
    });

    // ボタンを押したとき
    function sendReaction(type, id) {
      const key = `clicked_${type}_${id}`;
      if (localStorage.getItem(key)) {
        alert("このボタンは一度しか押せません。");
        return;
      }

      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ action: "add", id, type }),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.json())
      .then(data => {
        document.querySelector(".heart-count").textContent = data.heart || 0;
        document.querySelector(".report-count").textContent = data.report || 0;
        localStorage.setItem(key, "true");
      })
      .catch(err => console.error(err));
    }
  </script>
</body>
</html>
    // ✅ データ取得
    fetch(sheetUrl)
      .then(res => {
        if (!res.ok) throw new Error('ネットワークエラー');
        return res.text();
      })
      .then(csvText => {
        loading.style.display = 'none';
        const allRows = parseCSV(csvText);
        const rows = allRows.slice(1); // ヘッダー除外

        if (rows.length === 0) {
          postsContainer.innerHTML = '<p>現在、募集中の実験はありません。</p>';
          return;
        }
       rows.reverse().forEach((cols, index) => {
  if (cols.length < 3) return; // タイムスタンプ・実験名・詳細が必要

  const timestamp = cols[0].trim();     // A列（タイムスタンプ）
  const experimentName = cols[1].trim(); // B列（実験名）←C列が1つ前に詰まった
  const detailText = cols[2].trim().replace(/\r?\n/g, '<br>'); // C列（詳細）

  const postDiv = document.createElement('div');
  postDiv.className = 'post card';
  postDiv.innerHTML = `
    <div class="post-header">
      <span class="post-number">#${rows.length - index}</span>
      <span class="post-timestamp">${timestamp}</span>
      <h2>${experimentName}</h2>
    </div>
    <div class="post-detail" style="display:none;">
      <p>${detailText}</p>
    </div>
    <button class="toggle-btn">▼ 詳細を表示</button>
  `;

  // ✅ 詳細開閉
  const toggleBtn = postDiv.querySelector('.toggle-btn');
  const detail = postDiv.querySelector('.post-detail');
  toggleBtn.addEventListener('click', () => {
    const isVisible = detail.style.display === 'block';
    detail.style.display = isVisible ? 'none' : 'block';
    toggleBtn.textContent = isVisible ? '▼ 詳細を表示' : '▲ 閉じる';
  });

  postsContainer.appendChild(postDiv);
});

      })
      .catch(err => {
        console.error('CSV読み込みエラー:', err);
        loading.style.display = 'none';
        error.style.display = 'block';
      });
  </script>
</body>
</html>
