<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>実験募集掲示板</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="site-header">
    <nav class="navbar">
      <h1 class="logo">実験募集掲示板</h1>
      <ul class="nav-links">
        <li><a href="index.html">ホーム</a></li>
        <li><a href="policy.html">ポリシー</a></li>
        <li><a href="#posts">募集</a></li>
        <li><a href="contact.html">お問い合わせ</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <section id="posts" class="post-list">
      <div id="loading" class="loading">投稿を読み込んでいます...</div>
      <div id="error" class="error" style="display:none;">投稿データを読み込めませんでした。</div>
    </section>
  </main>

  <footer class="footer">
    © あなたの研究室名
  </footer>

  <script>
    // ✅ GoogleスプレッドシートのCSV公開URL
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRwty1oe-6s7l6GPnMyo-nhQk2vDfnWKsdlzmgdGo1ey7g1QNLusXc_iIbAJYdE8RhLwRnLobvrBvDV/pub?output=csv';

    const postsContainer = document.getElementById('posts');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');

    fetch(sheetUrl)
      .then(res => {
        if (!res.ok) throw new Error('ネットワークエラー');
        return res.text();
      })
      .then(csvText => {
        loading.style.display = 'none';
        const rows = csvText.split('\n').slice(1); // ヘッダーを除く

        if (rows.length === 0) {
          postsContainer.innerHTML = '<p>現在、募集中の実験はありません。</p>';
          return;
        }

        rows.forEach((row, index) => {
          const cols = row.split(',');
          if (cols.length < 3) return; // 3列以上を想定

          const title = cols[0].trim();  // タイトル（短文）
          const shortDesc = cols[1].trim(); // 短い説明（最初に見せる）
          const longDesc = cols[2].trim();  // 詳細（クリック後に表示）
          const formUrl = cols[3] ? cols[3].trim() : ''; // 応募フォームURL（任意）

          const postDiv = document.createElement('div');
          postDiv.className = 'post card';
          postDiv.innerHTML = `
            <div class="post-header">
              <span class="post-number">#${index + 1}</span>
              <h2>${title}</h2>
            </div>
            <p class="post-short">${shortDesc}</p>
            <div class="post-detail" style="display:none;">
              <p>${longDesc}</p>
              ${formUrl ? `<a class="button" href="${formUrl}" target="_blank">応募する</a>` : ''}
            </div>
            <button class="toggle-btn">▼ 詳細を表示</button>
          `;

          // ✅ クリックで詳細を開閉
          const toggleBtn = postDiv.querySelector('.toggle-btn');
          const detail = postDiv.querySelector('.post-detail');
          toggleBtn.addEventListener('click', () => {
            const isVisible = detail.style.display === 'block';
            detail.style.display = isVisible ? 'none' : 'block';
            toggleBtn.textContent = isVisible ? '▼ 詳細を表示' : '▲ 閉じる';
          });

          postsContainer.appendChild(postDiv);
        });
      })
      .catch(err => {
        console.error('CSV読み込みエラー:', err);
        loading.style.display = 'none';
        error.style.display = 'block';
      });
  </script>
</body>
</html>
